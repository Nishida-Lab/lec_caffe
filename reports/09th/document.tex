\documentclass[a4paper,10pt]{jsarticle}

% レイアウト
\setlength{\textwidth}{\fullwidth}
\setlength{\textheight}{39\baselineskip}
\addtolength{\textheight}{\topskip}
\setlength{\voffset}{-0.5in}
\setlength{\headsep}{0.3in}
\pagestyle{myheadings}

% パッケージ
\usepackage[dvipdfmx]{graphicx}
\usepackage{amsmath,amssymb,epsfig}
\usepackage{bm}
\usepackage{ascmac}
\usepackage{pifont}
\usepackage{multirow}
\usepackage{enumerate}
\usepackage{cases}
\usepackage{type1cm}
\usepackage{cancel}
\usepackage{url}
\usepackage{color}
\usepackage{listings,jlisting}
% 大きな中括弧
\usepackage{cases}

% 定義
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}
\def\vec#1{\mbox{\boldmath$#1$}}
\def\R{{\Bbb R}}

% カウンタの設定
\setcounter{section}{0}
\setcounter{subsection}{0}
\setcounter{subsubsection}{0}
\setcounter{equation}{0}

% キャプションの図をFigに変更
\renewcommand{\figurename}{Fig.}
\renewcommand{\tablename}{Tab.}

% 式番号を式(章番号.番号)に
% \makeatletter
% \renewcommand{\theequation}{\arabic{section}.\arabic{equation}}
% \@addtoreset{equation}{section}
% \makeatother

% プログラムに色をつける
\usepackage{color}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}

\lstset{style=mystyle}

% 表紙
\title{知能システム学特論レポート}
\author{
（DL2班）Caffe on Ubuntu\\
}
\date{2015年\ 7月\ 16日}

% ドキュメントの開始
\begin{document}
\maketitle
\section{報告者}
\begin{list}{}{}
 \item 15344203\hspace{0.5cm} 有田 裕太
 \item 15344206\hspace{0.5cm} 緒形 裕太
 \item 15344209\hspace{0.5cm} 株丹 亮
 \item 12104125\hspace{0.5cm} 宮本 和
\end{list}

\section{進行状況}

\begin{itemize}
\item 畳み込みネットワークと正規化層の理論について
\item データセットの作成準備
\end{itemize}

\section{理論研究}
\subsection{勾配の計算}

%%%%%% ogata %%%%%%
この層$l$のデルタを$\delta^{(l)}$と書き，全結合層に対する勾配計算の式を
形式的に適応すると，この層の重み${\bf W}={\bf W}^{(l)}$の勾配は
%
\begin{equation}
 \partial{\bf W}= {\bf \delta}^{(l)}{\bf z}^{{(l-1)}^\top}
\end{equation}
%
で与えられる．上述のように${\bf W}$の多くの成分はもともと０であり．そうで
ない成分はも重み共有により同じ変数(フィルタの係数)に対応する．そこでフィ
ルタの係数$\bf{h}$についての勾配$\partial{\bf W}$に変形する必要がある．微
分の線形性より，$\partial\bf{h}$の成分$r$は次のように表せる．
%
\begin{equation}
 (\partial{\bf h})_r =\sum_{i,j}^{}({\bf T}_r\odot\partial{\bf W})_{ji}
\end{equation}
%
$\odot$は成分ごとの積を表し，和は行列の全成分の和を表す．

プーリング層には学習の対象となるパラメータはないので，勾配計算は必要ない
が，さらに下層に伝えるデルタの逆伝播計算は必要である．それにはプーリング
の種類ごとに${\bf W}^{(l+1)}$を定め，式??を計算する．平均プーリング
では層$l+1$のユニット$j$のサイズ$H \times H$の受容野（プーリング領域）を
$P_{j}$として
%
\begin{equation}
 w_{ji}^{(l+1)} =
	\begin{cases}
    \frac{1}{H^2} & (\text {if}  \  i\in{P_j}) \\
    0 & (\text{otherwise})
  \end{cases}
\end{equation}

とする．上の逆伝播計算では出力層ユニットのデルタに${\bf
W}^{(l+1)^{\top}}$を掛けることで．それらが入力層に均等に振り割られる．最
大プーリングでは，層$l+1$のユニット$j$のみ$w_{ji}=1$とし，それ以外を
$w_{ji}=0$とする．つまりサンプルごとに（順伝播時のプーリングの結果により）
重みが変化する．逆伝播計算では最大値を返したユニットにデルタがそのまま伝
えられる．


\section{プログラミング}
\subsection{学習パラメータの設定}
学習を行う上で必要なパラメータについて説明する．この設定が記述されているファイルはcifar10\_quick\_solver.prototxtである．
以下に設定ファイルの内容を示し，各パラメータに関する意味を記述する．

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=single, firstnumber=1, numbers=left, breaklines=true]
net: "examples/cifar10/cifar10_quick_train_test.prototxt"
test_iter: 100
test_interval: 500
base_lr: 0.0001
momentum: 0.9
weight_decay: 0.004
lr_policy: "fixed"
display: 100
max_iter: 4000
snapshot: 4000
snapshot_prefix: "examples/cifar10/cifar10_quick"
solver_mode: GPU
\end{lstlisting}

ここでバッチ数と呼ばれる単位を導入する．バッチ数は教師データを一度にいくつ処理するか（バッチサイズ）を決定し，これを1[batch]とする．
Caffeでは繰り返し数をバッチ数で指定している．

\begin{description}
  \item[net :]学習用ネットワーク定義ファイルを指定する．
  \item[test\_iter :]学習中の正答率評価を1回行うのに使う評価セットのデータ数をバッチ数で指定．評価セットのデータ数とバッチサイズの除算を行い，この数値を設定することで正答率評価にすべての評価セットを用いることができる．
  \item[test\_interval :]テストデータから正答率評価を行う間隔をバッチ数で指定．データ数が多い場合，正答評価に多くの時間がかかるので用いるデータセットの規模によって適切な値に設定する必要がある．
  \item[base\_lr,\ momentum,\ weight\_decay,\ lr\_policy :]学習率に関する設定．
  \item[display :]学習中のステータスを出力する回数をバッチ数で指定．
  \item[max\_iter :]学習の計算を最大どれだけ続けるかを訓練データのバッチ数で指定．ここで指定された数値とバッチサイズの積算が学習が終了するまでの処理する画像枚数となる．
  \item[snapshot,\ snapshot\_prefix :]学習の途中経過を保存する間隔と場所を指定．
  \item[solver\_mode :]学習をCPUのみ，あるいはGPUを用いるかを指定．
\end{description}


\section{今後の課題}
\begin{itemize}
 \item 理論研究を進める．
 \item データセットの作成，学習実行結果の評価と過程の可視化．
\end{itemize}

\end{document}